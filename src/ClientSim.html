<!DOCTYPE html>
<script src='../dist/main.js'></script>
<script>

    function createTable(tableId, tableName, columns) {
        var tables = document.getElementById("tables");
        table = document.createElement("table");   
        table.setAttribute("id", tableId);
        table.border = '1';
        tables.appendChild(table); 

        var header = table.createTHead();

        for (const column of columns ) {
            var c = table.tHead.appendChild(document.createElement("th"));
            c.innerHTML = column;
        }
    }

    function appendRowUtil(tableId, rowId, values) {
        var table = document.getElementById(tableId);

        var rowCount = table.rows.length;
        var row = table.insertRow(rowCount);

        values.forEach((value, i)=> {
            row.insertCell(i).innerHTML = value;
        });
    }

    var client

    callback = {
        loginSuccess: function(sessionId) {
            var logs = document.getElementById("logs")
            logs.value += `login success ${sessionId}\n`
        },
        logoutSuccess: function(sessionId) {
            var logs = document.getElementById("logs")
            logs.value += `logout success ${sessionId}\n`
        },
        createUserSuccess: function() {
            var logs = document.getElementById("logs")
            logs.value += `create user success\n`
        },
        createTableSuccess: function(tableId) {
            var logs = document.getElementById("logs")
            logs += `create table success ${tableId}\n`
        },
        subscribeTablesSuccess: function() {
            var logs = document.getElementById("logs")
            logs += `subscribe tables success\n`
        },
        appendRowSuccess: function(rowId) {
            var logs = document.getElementById("logs")
            logs += `append row success: ${rowId}\n`
        },
        removeRowSuccess: function(rowId) {
            var logs = document.getElementById("logs")
            logs += `remove row success: ${rowId}\n`
        },
        updateCellSuccess: function(tableId, rowId, columnName) {
            var logs = document.getElementById("logs")
            logs += `update cell success: ${tableId} ${rowId} ${columnName}\n`
        },
        tableSnap: function(table) {
            var t = document.getElementById("tableSnap")
            t.value += `${JSON.stringify(table)}\n`
            createTable(table.tableId, table.tableName, table.columns)
            table.rows.forEach(row => {
                appendRowUtil(table.tableId, row.rowId, row.values)
            })
        },
        tableUpdate: function(update) {
            var t = document.getElementById("tableUpdate")
            t.value += `${JSON.stringify(update)}\n`
        },
        appendRow: function(tableId, rowId, values) {
            appendRowUtil(tableId, rowId, values)
        }
    }

    function getClient(host, port, callback) {
        if (!client) {
            client = new Client(host, port, callback)
            return client
        }
        else {
            return client
        }
    }

    client = getClient('localhost', 8080, callback)

    function getUserId() {
        console.log(document.getElementById('userId').value)
        return document.getElementById('userId').value
    }
    function getPassword() {
        console.log(document.getElementById('password').value)
        return document.getElementById('password').value
    }
    function getNewUserId() {
        return document.getElementById('newUserId').value
    }
    function getNewUserName() {
        return document.getElementById('newUserName').value
    }
    function getNewUserPassword() {
        return document.getElementById('newUserPassword').value
    }
    function getNewTableName() {
        return document.getElementById('tableNameCT').value
    }
    function getNewTableColumns() {
        return JSON.parse(document.getElementById('tableColumnsCT').value)
    }
    function getAppendRowTableId() {
        return document.getElementById('tableIdAR').value
    }
    function getAppendRowValues() {
        return JSON.parse(document.getElementById('valuesAR').value)
    }
</script>
<head>QIN Client Sim</head>
<body>
    <p>
        <button onclick="client.login(getUserId(), getPassword());">login</button>
        user id: <input type='text' id='userId'></input> 
        password: <input type='text' id='password'></input>
    </p>
    <p>
        <button id='logout' onclick="client.logout()">logout</button>
    </p>
    <p>
        <button id='createUser' onclick="client.createUser(getNewUserId(), getNewUserName(), getNewUserPassword())">create user</button>
        user id: <input type='text' id='newUserId'></input> 
        user name: <input type='text' id='newUserName'></input> 
        password: <input type='text' id='newUserPassword'></input>
    </p>
    <p>
        <button id='createTable' onClick="client.createTable(getNewTableName(), getNewTableColumns())">create table</button>
        name: <input type='text' id='tableNameCT'></input> 
        columns: <input type='text' id='tableColumnsCT'></input> 
    </p>
    <p>
        <button id='appendRow' onClick="client.appendRow(getAppendRowTableId(), getAppendRowValues())">append row</button>
        table id: <input type='text' id='tableIdAR'></input> 
        values: <input type='text' id='valuesAR'></input> 
    </p>
    <p>
        <button>delete row</button>
        table id: <input type='text' id='tableIdDR'></input> 
        row id: <input type='text' id='rowIdDR'></input> 
    </p>
    <p>
        <button>update cell</button>
        table id: <input type='text' id='tableIdUC'></input> 
        column: <input type='text' id='columnUC'></input> 
        row id: <input type='text' id='rowIdUC'></input> 
    </p>
    <p>
        <button id='subscribeTables' onClick="client.subscribeTables()">subscribe tables</button>
    </p>
    <p>
        <button id='unsubscribeTables'>unsubscribe tables</button>
    </p>
    <div id="tables">tables</div>
    <p>
        table update<br><textarea id="tableUpdate"></textarea>
    </p>
    <p>
        table snap<br><textarea id="tableSnap"></textarea>
    </p>
    <p>
        log<br><textarea id="logs"></textarea>
    </p>
</body>